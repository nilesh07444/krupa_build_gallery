@using KrupaBuildGallery.Model;
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
    var options = {
        "key": "@ViewBag.Key", // Enter the Key ID generated from the Dashboard
        "amount": "@ViewBag.Amount", // Amount is in currency subunits. Default currency is INR. Hence, 50000 means 50000 paise or ₹500.
        "currency": "INR",
        "name": "Shopping & Saving",
        "description": "@ViewBag.Description",
        "image": "https://razorpay.com/favicon.png",
        "order_id": "@ViewBag.OrderId",// Replace this with the order_id created using Orders API (https://razorpay.com/docs/api/orders).
        "handler": function (response) {
            StartLoading();
            PlaceOrder(response.razorpay_payment_id, response.razorpay_order_id, response.razorpay_signature);
        },
        "prefill": {
            "name": "@clsClientSession.FirstName @clsClientSession.LastName",
            "email": "@clsClientSession.Email",
            "contact": "@clsClientSession.MobileNumber"
        },
        "notes": {
            "address": "note value"
        },
        "theme": {
            "color": "#F37254"
        }
    };

    if ($("#rzp-placeorder").length > 0) {
        $(document).off('click').on('click', '#rzp-placeorder', function (e) {
            if (lstpincodesstr != null && lstpincodesstr.length > 0) {
                var pincodd = $("input[name=shippincode]").val();
                if ($("input[name=shippincode]").val() != "" && lstpincodesstr.indexOf(pincodd.trim()) < 0) {
                    alert("Currently delivery not available to this pincode "+pincodd);
                    return false;
                }
            }
            if ($("#isCashondelivery").length > 0 && $("#isCashondelivery").val() == "True") {
                var ord = parseFloat($("#Orderamout").val());
                if ($("#cashlimitoforder").length > 0) {
                    var limitordr = parseFloat($("#cashlimitoforder").val());
                    if (ord > limitordr) {
                        alert("Your Total Order Amount exceed the Cash On Delivery limit");
                        return false;
                    }
                }

                 if ($("#cashlimitoforderyear").length > 0) {
                     var limitordr = parseFloat($("#cashlimitoforderyear").val());
                     var cshordryear = parseFloat($("#cashorderyear").val());
                     cshordryear = cshordryear + ord;
                    if (cshordryear > limitordr) {
                        alert("Your Yearly Cash On Delivery limit exceed");
                        return false;
                    }
                }
            }
            $(".errorcls").html("");
            var flg = true;
            //$("input[name=shipfirstname]").siblings('.errorcls')
            if ($("input[name=shipfirstname]").val() == "") {
                $("input[name=shipfirstname]").siblings('.errorcls').html("First Name is Required");
                flg = false;
            }
            if ($("input[name=shiplastname]").val() == "") {
                $("input[name=shiplastname]").siblings('.errorcls').html("Last Name is Required");
                flg = false;
            }
            if ($("input[name=shipphone]").val() == "") {
                $("input[name=shipphone]").siblings('.errorcls').html("Phone number is Required");
                flg = false;
            }
            else {
                   var a = /^\d{10}$/;
                if (!a.test(($("input[name=shipphone]").val()))) {
                    $("input[name=shipphone]").siblings('.errorcls').html("Invalid Phone number");
                    flg = false;
                }
            }
            if ($("input[name=shipemailaddress]").val() != "") {
                var a =/^([a-zA-Z0-9_\.\-\+])+\@@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                if (!a.test(($("input[name=shipemailaddress]").val()))) {
                    $("input[name=shipemailaddress]").siblings('.errorcls').html("Invalid Email");
                    flg = false;
                }
            }


            if ($("input[name=shipaddress]").val() == "") {
                $("input[name=shipaddress]").siblings('.errorcls').html("Address is Required");
                flg = false;
            }
            if ($("input[name=shipstate]").val() == "") {
                $("input[name=shipstate]").siblings('.errorcls').html("State is Required");
                flg = false;
            }
            if ($("input[name=shipcity]").val() == "") {
                $("input[name=shipcity]").siblings('.errorcls').html("City is Required");
                flg = false;
            }
            if ($("input[name=shippincode]").val() == "") {
                $("input[name=shippincode]").siblings('.errorcls').html("Postal Code is Required");
                flg = false;
            }



            if ($("input[name=payment-group]:checked").length == 0) {
                alert("Please select payment method");
                flg = false;
            }
            else if (parseFloat($("#payment-2").attr("data-attrblns")) > 0 && !$("#payment-2").is(":checked")) {
                alert("Please select online payment method");
                flg = false;
            }

            if (flg == true) {
                if ($("#payment-2").is(":checked") && parseFloat($("#onlineamtinorder").val()) > 0) {
                      var isitemexists = CheckItemExists("ByOther",options,e);
                }
                else {
                     var isitemexists = CheckItemExists("ByCredit");
                }
            }
        });
    }


</script>