@using KrupaBuildGallery.Model;
@using KrupaBuildGallery.Helper;

@model List<ProductItemVM>

@{
    ViewBag.Title = "Product List";
    List<tbl_Products> lstProdt = ViewData["lstProduc"] as List<tbl_Products>;
    List<tbl_SubProducts> lstSubProdt = ViewData["lstSubProduc"] as List<tbl_SubProducts>;
    //ViewData["lstSubProduc"] = lstSubProd;
}
<link href="~/Content/assets/css/rateit.css" rel="stylesheet" />
<style>
    .wishlistcls {
        color: #ff4c3b !important;
    }

    .product-top-filter {
        border: none !important;
    }

    .custlbl {
        color: black !important;
        cursor:pointer;
    }

    .ulcls {
        margin-top: 10px;
    }
    .ulcls li{
display:block !important;
    }
    .clsacvtmenu .custlbl {
        color: #3e5fd6 !important;
    }
</style>
<script src="~/Scripts/jquery.rateit.js"></script>
<div class="breadcrumb-section">
    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <div class="page-title">
                    <h2>@ViewBag.Name</h2>
                </div>
            </div>
            <div class="col-sm-6">
                <nav aria-label="breadcrumb" class="theme-breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/">Home</a></li>
                        <li class="breadcrumb-item active" aria-current="page">@ViewBag.Name</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</div>
<section class="p-t-0 j-box ratio_square">
    <div class="collection-wrapper">
        <div class="container">
            <div class="row">
                <div class="col-sm-3 collection-filter" style="margin-top:15px;">
                    <!-- side-bar colleps block stat -->
                    @if (lstProdt != null && lstProdt.Count() > 0)
                    {
                        <div class="collection-filter-block">
                            <!-- brand filter start -->
                            <div class="collection-mobile-back"><span class="filter-back"><i class="fa fa-angle-left" aria-hidden="true"></i> back</span></div>

                            @if (lstProdt != null && lstProdt.Count() > 0)
                            {
                                long prodidd = Convert.ToInt64(ViewBag.ProductId);
                                <div class="collection-collapse-block open">
                                    <h3 class="collapse-block-title">Products</h3>
                                    <div class="collection-collapse-block-content" style="display: block;">
                                        <div class="collection-brand-filter">
                                            <ul class="ulcls">
                                                @foreach (var objj in lstProdt)
                                                {
                                                    string stractvclass = "";

                                                    if (prodidd != -1 && objj.Product_Id == prodidd)
                                                    {
                                                        stractvclass = "clsacvtmenu";
                                                    }
                                                    <li><a href="javascript:void(0);" class="@stractvclass" onclick="filteitemsbyproduct('@objj.Product_Id');"><label class="custlbl">@objj.ProductName</label></a></li>
                                                }
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            }


                            @if (lstSubProdt != null && lstSubProdt.Count() > 0)
                            {
                                long subprodidd = Convert.ToInt64(ViewBag.SubProductId);
                                string strstyll = "display: none;";
                                string clssc = "";
                                if(subprodidd > 0)
                                {
                                    strstyll = "display: block;";
                                    clssc = "open";
                                }
                                 <div class="collection-collapse-block @clssc">
                                    <h3 class="collapse-block-title">Sub Products</h3>
                                    <div class="collection-collapse-block-content" style="@strstyll">
                                        <div class="collection-brand-filter">
                                            <ul class="ulcls">
                                                @foreach (var objj in lstSubProdt)
                                                {

                                                    string stractvclass = "";                                                  
                                                    if (subprodidd != -1 && objj.SubProductId == subprodidd)
                                                    {
                                                        stractvclass = "clsacvtmenu";
                                                    }
                                                      <li><a href="javascript:void(0);" onclick="filteitemsbysubproduct('@objj.SubProductId');" class="@stractvclass"><label class="custlbl">@objj.SubProductName</label></a></li>

                                                    }
</ul>
                                        </div>
                                    </div>
                                </div>
                            }

                        </div>
                        <!-- silde-bar colleps block end here -->
                    }
                    </div>
                <div class="collection-content col" style="margin-top: 15px;">
                    <div class="page-main-content">
                        <div class="row">
                            @if (Model != null && Model.Count > 0)
                            {
                                <div class="col-sm-12">
                                    <div class="collection-product-wrapper">
                                        <div class="product-top-filter">
                                            <div class="row">
                                                <div class="col-xl-12">
                                                    <div class="filter-main-btn"><span class="filter-btn btn btn-theme"><i class="fa fa-filter" aria-hidden="true"></i> Filter</span></div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <h4 style="margin-top: 10px;margin-right:10px;">
                                                    Sort by
                                                </h4>
                                                <select id="selectsortitems" class="form-control" style="width:300px;" onchange="sortproductitems();">
                                                    <option value="1">Price: Low to High</option>
                                                    <option value="2">Price: High to Low</option>
                                                    <option value="3">Name: A - Z</option>
                                                    <option value="4">Name: Z - A</option>
                                                    <option value="5">Star Rating</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="product-wrapper-grid">
                                            <div class="row">
                                                <div class="col">
                                                    <div class="theme-tab">
                                                        <div class="tab-content-cls">
                                                            <div id="tab-4" class="tab-content active default" style="display: block;">
                                                                <div class=" no-slider row">
                                                                    @if (Model != null && Model.Count > 0)
                                                                    {
                                                                        foreach (ProductItemVM item in Model)
                                                                        {
                                                                            string imgpath = "";
                                                                            string clswishlist = "";
                                                                            if (!string.IsNullOrEmpty(item.MainImage))
                                                                            {
                                                                                if (File.Exists(Server.MapPath("~/Images/ProductItemMedia/" + item.MainImage)))
                                                                                {
                                                                                    imgpath = "/Images/ProductItemMedia/" + item.MainImage;
                                                                                }
                                                                                else
                                                                                {
                                                                                    imgpath = @ErrorMessage.DefaultImagePath;
                                                                                }
                                                                            }
                                                                            else
                                                                            {
                                                                                imgpath = @ErrorMessage.DefaultImagePath;
                                                                            }
                                                                            if (item.IsWishListItem)
                                                                            {
                                                                                clswishlist = "wishlistcls";
                                                                            }
                                                                            <div class="product-box" style="width: 100%; display: inline-block;">
                                                                                <div class="img-wrapper">
                                                                                    <!-- front image -->
                                                                                    <div class="front">
                                                                                        <a href="/client/products/detail/@item.ProductItemId" class="bg-size blur-up lazyloaded" style="background-image: url(@imgpath); background-size: cover; background-position: center center; display: block;" tabindex="0"><img src="@imgpath" class="img-fluid blur-up lazyload bg-img" alt="" style="display: none;"></a>
                                                                                    </div>
                                                                                    <div class="cart-info cart-wrap">
                                                                                        <button data-toggle="modal" data-target="#addtocart" style="display:none;" title="Add to cart" tabindex="0" style="cursor:pointer;" onclick="AddtoCartfunc(@item.ProductItemId, 1,'@item.IsCashonDelieveryuse.ToString()');"><i class="ti-shopping-cart"></i></button>
                                                                                        @if (clsClientSession.UserID > 0)
                                                                                        {
                                                                                            <a href="javascript:void(0)" title="Add to Wishlist" tabindex="0" onclick="addremovewishlist('@item.ProductItemId',this);"><i class="fa fa-heart @clswishlist" aria-hidden="true"></i></a>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <a href="javascript:void(0)" title="Add to Wishlist" tabindex="0" onclick="alert('Please login for add item to wishlist');"><i class="fa fa-heart @clswishlist" aria-hidden="true"></i></a>
                                                                                        }
                                                                                    </div>
                                                                                </div>
                                                                                <div class="product-detail" style="height:100%;">
                                                                                    <div class="rateit" data-rateit-value="@item.Ratings" style="margin-top:5px;" data-rateit-ispreset="true" data-rateit-readonly="true"></div>
                                                                                    <a href="/client/products/detail/@item.ProductItemId" tabindex="0">
                                                                                        <h6>@item.ItemName</h6>
                                                                                    </a>
                                                                                    @if (clsClientSession.UserID == 0 || (clsClientSession.UserID > 0 && clsClientSession.RoleID == 1))
                                                                                    {
                                                                                        <h4>₹ @item.CustomerPrice <del>₹ @item.MRPPrice</del></h4>

                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <h4>₹ @item.DistributorPrice <del>₹ @item.MRPPrice</del></h4>
                                                                                    }

                                                                                </div>
                                                                            </div>
                                                                        }

                                                                    }

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <br />
                                        <div class="product-pagination" style="display:none;">
                                            <div class="theme-paggination-block">
                                                <div class="row">
                                                    <div class="col-xl-6 col-md-6 col-sm-12">
                                                        <nav aria-label="Page navigation">
                                                            <ul class="pagination">
                                                                <li class="page-item"><a class="page-link" href="#" aria-label="Previous"><span aria-hidden="true"><i class="fa fa-chevron-left" aria-hidden="true"></i></span> <span class="sr-only">Previous</span></a></li>
                                                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                                                <li class="page-item"><a class="page-link" href="#" aria-label="Next"><span aria-hidden="true"><i class="fa fa-chevron-right" aria-hidden="true"></i></span> <span class="sr-only">Next</span></a></li>
                                                            </ul>
                                                        </nav>
                                                    </div>
                                                    <div class="col-xl-6 col-md-6 col-sm-12">
                                                        <div class="product-search-count-bottom">
                                                            <h5>Showing Products 1-24 of 10 Result</h5>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div style="height:250px;width: 100%;">
                                    <h4 style="margin-top:80px;margin-left: 40%;">No Product Items....</h4>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<input type="hidden" id="hdncatids" value="@ViewBag.CatId" />
<input type="hidden" id="hdnprodids" value="@ViewBag.ProductId" />
<input type="hidden" id="hdnsubproids" value="@ViewBag.SubProductId" />
<input type="hidden" id="hdnsortbyids" value="@ViewBag.SortBy" />
<script>
    $(document).ready(function () {
        $("#selectsortitems").val("@ViewBag.SortBy");
    });
    function sortproductitems() {
        var pagefrom = '@ViewBag.FromPage';
        var sortid = $("#selectsortitems").val();
        //location.href = location.origin + "/" + pagefrom + "&sortby=" + sortid;
        var catids = $("#hdncatids").val();
        var productids = $("#hdnprodids").val();
        var subprodid = $("#hdnsubproids").val();
        if (productids == "-1") {
            location.href = location.origin + "/products/ItemList?CatId=" + catids + "&sortby=" + sortid;
        }
        else if (productids != "-1" && subprodid == "-1") {
            location.href = location.origin + "/products/ItemList?CatId=" + catids + "&sortby=" + sortid + "&ProductId=" + productids;
        }
        else if (productids != "-1" && subprodid != "1") {
            location.href = location.origin + "/products/ItemList?CatId="+catids+"&sortby="+sortid + "&ProductId="+productids+"&SubProductId="+subprodid ;
        }


    }

    function filteitemsbyproduct(ids) {
        var pagefrom = '@ViewBag.FromPage';
        var catids = $("#hdncatids").val();
        var sortid = $("#selectsortitems").val();
        location.href = location.origin + "/products/ItemList?CatId="+catids+"&sortby="+sortid + "&ProductId="+ids;
    }

     function filteitemsbysubproduct(idd) {
        var pagefrom = '@ViewBag.FromPage';
        var catids = $("#hdncatids").val();
        var productids = $("#hdnprodids").val();
        var sortid = $("#selectsortitems").val();
        location.href = location.origin + "/products/ItemList?CatId="+catids+"&sortby="+sortid + "&ProductId="+productids+"&SubProductId="+idd ;
    }

    function addremovewishlist(itemid,objthis) {
    var URL = '/Client/Products/AddRemoveWishList';
    jQuery.ajax({
        type: 'POST',
        async: true,
        url: URL + "?ItemId=" + itemid,
        success: function (result) {
            if (result == "Success") {
                if ($(objthis).find('.fa-heart').hasClass("wishlistcls")) {
                    $(objthis).find('.fa-heart').removeClass("wishlistcls");
                    msgsuccess('Item Successfully removed from wishlist');
                }
                else {
                    $(objthis).find('.fa-heart').addClass("wishlistcls");
                    msgsuccess('Item Successfully added in wishlist');
                }
            }
        },
        error: function (resultData) {
            console.log("error");

        }
    });
   }
    function msgsuccess(msg) {
          $.notify({
        icon: 'fa fa-check',
        title: 'Success!',
        message: msg
    }, {
        element: 'body',
        position: null,
        type: "info",
        allow_dismiss: true,
        newest_on_top: false,
        showProgressbar: true,
        placement: {
            from: "top",
            align: "right"
        },
        offset: 20,
        spacing: 10,
        z_index: 1031,
        delay: 5000,
        animate: {
            enter: 'animated fadeInDown',
            exit: 'animated fadeOutUp'
        },
        icon_type: 'class',
        template: '<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert">' +
            '<button type="button" aria-hidden="true" class="close" data-notify="dismiss">×</button>' +
            '<span data-notify="icon"></span> ' +
            '<span data-notify="title">{1}</span> ' +
            '<span data-notify="message">{2}</span>' +
            '<div class="progress" data-notify="progressbar">' +
            '<div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>' +
            '</div>' +
            '<a href="{3}" target="{4}" data-notify="url"></a>' +
            '</div>'
    });
    }

</script>